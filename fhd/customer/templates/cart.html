{% extends 'base.html' %}
{% block title %}Shopping Cart{% endblock %}

{% block content %}
<script>
    function confirmDelete(deleteUrl) {
        if (confirm("Are you sure you want to remove every item in the shopping cart?")) {
            window.location.href = deleteUrl;
        }
    }
</script>
<div class="container content" style="flex: 1 0 auto;">
    <div class="row">
        <div class="col-12">
            <h1>Shopping Cart</h1>
            <hr>
            <table class="table table-striped table-hover">
                <thead>
                    <tr class="table-primary">
                        <th>Item</th>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Unit</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Subtotal</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% if session['shoppingcart'] %}
                    {% for product in cart_items %}
                    <tr>
                        <td>{{ loop.index }}</td> 
                        <td>
                        {% if product.image %}
                        <img src="data:image/jpeg;base64,{{ product.image }}" alt="{{ product.name }}" width="50" height="45"> <!-- Product Image -->
                        {% endif %}
                        </td>
                        <td>{{ product.name }}</td> 
                        <td>{{ product.unit }}</td> 
                        <form action="{{ url_for('customer.updatecart', product_id=product.product_id) }}" method="post" >
                        <td>${{ product.price }}</td> 
                        <td><input type="number" name="quantity"min="1" value="{{product.quantity }}" style="width: 3em; margin-left: 5px; margin-right: 5px;"></td> 
                        {% set subtotal = product.quantity|int * product.price|float %}
                        <td>${{ "%0.2f"|format(subtotal|float)}}</td>
                        <td><button type="submit" class="btn btn-sm btn-primary">Update</button></td>
                        </form>
                        <td><a href="{{url_for('customer.deleteitem', id=product.product_id)}}" class="btn btn-sm btn-danger">Remove</a>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6">Your cart is empty</td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                </tbody>
                    <table class="table table-sm">
                    <tr>
                        <td><a href="javascript:history.back()" class="btn btn-sm btn-primary" role="button">Continue Shopping</a></td>
                        <td><h5>Grand Total: ${{grandtotal}} (inclusive of ${{tax}} GST)</h5></td>
                        <td><a href="#" class="btn btn-sm btn-primary float-right">Checkout</a></td>
                        <td><a href="#" onclick="confirmDelete('{{url_for('customer.clearcart')}}')" class="btn btn-sm btn-danger float-right">Clear cart</a></td>
                    </tr>
                </table>
            </table>

        </div>
    </div>
</div>

{% endblock content %}
