{% extends 'base.html' %}
{% block title %}Shopping Cart{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <section class="text-center container">
        <div class="row py-lg-2">
            <div class="col-lg-6 col-md-8 mx-auto">
                <h1 class="fw-light">Shopping Cart</h1>
            </div>
        </div>
    </section>
</head>

<div class="container">
    <table class="table table-striped table-hover">
        <thead>
            <tr class="table-primary">
                <th>Item</th>
                <th>Image</th>
                <th>Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Subtotal</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for key, product in session['shoppingcart'].items() %}
            <tr>
                <td>{{ loop.index }}</td> 
                <td>
                {% if product.image %}
                <img src="data:image/jpeg;base64,{{ product.image }}" alt="{{ product.name }}" width="50" height="45"> <!-- Product Image -->
                {% endif %}
                </td>
                <td>{{ product.name }}</td> 
                <form action="" method="post">
                <td>${{ product.price }}</td> 
                <td><input type="number" name="quantity" min="1" value="{{product.quantity }}"></td> 
                {% set subtotal = product.quantity|int * product.price|float %}
                <td>${{ "%0.2f"|format(subtotal|float)}}</td>
                <td><button type="submit" class=""btn btn-sm btn-info>Update</button></td>
                </form>
                <td><a href="{{url_for('customer.deleteitem', id=key)}}" class="btn btn-sm btn-danger">Remove</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6">Your cart is empty</td>
            </tr>
            {% endfor %}
            <tr>
                <td></td>
                <td><a href="/">Continue Shopping</a></td>
                <td colspan="3">Tax: ${{tax}}</td>
                <td colspan="4"><h4>Grand Total: ${{grandtotal}}</h4></td>
                <td><a href="{{url_for('customer.clearcart')}}" class="btn btn-sm btn-danger float-right">Clear cart</a></td>
            </tr>
        </tbody>
    </table>
</div>
</form>

{% endblock content %}
